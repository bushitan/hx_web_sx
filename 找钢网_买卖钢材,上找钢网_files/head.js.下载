var _head={loading:false,pageIndex:1,init:function(){_head.onlineService();_head.msg_remind();_head.msg_todo();_head.seller_top_num()},remind_info:function(g){var c=parseInt(g.paymentY)||0,b=parseInt(g.paymentN)||0,e=g.compayStatus||false,a=0;var d="";if(c){a++;d+='<li><div class="msn_list_left">[提醒]</div><div class="msn_list_right">'+c+'笔订单未付款<a class="gotoaction" href="'+urlPath.memberUrl+'/Account/MyOrder">去查看</a></div></li>'}if(b){a++;d+='<li><div class="msn_list_left">[提醒]</div><div class="msn_list_right">'+b+'笔订单未填提货函<a class="gotoaction" href="'+urlPath.memberUrl+'/Account/MyOrder">去查看</a></div></li>'}if(e){$.each(e.split("<p>"),function(h,j){if(j){a++;d+='<li><div class="msn_list_left">[提醒]</div><div class="msn_list_right">'+j.replace("</p>","")+"</div></li>"}})}if(d){$("#_remind_list .msn_content_inner").show().find("ul").html(d);$("#_remind_list .msn_content_empty").remove();$("#_remind_list .msn_content_inner a").addClass("gotoaction")}$("#_remind_num").data("count",a).html("提醒（"+a+"）");var f=a+$("#_todo_num").data("count")||0;f>0?$("#_msg_top_num").html(f>99?"99+":f).show():$("#_msg_top_num").hide();return},msg_remind:function(){$.getJSON(urlPath.memberUrl+"/userMessage/GetUserMessage?callback=?",function(a){if(a&&a.isLogin){_head.remind_info(a)}if(a.msg==="未登陆"){$("#msn_chunk").remove()}})},msg_todo:function(){if(_head.loading){return false}_head.loading=true;$.getJSON(location.protocol+"//seller."+urlPath.domain+"/jsonp/todoList?jsoncallback=?&pageIndex="+_head.pageIndex,function(c){if(c&&c.isOk&&c.total){var a="";$.each(c.rows,function(d,f){a+='<li><div class="msn_list_left">[待提交意向]</div><div class="msn_list_right"><p class="msn_list_kind">您求购的 '+(f.categoryName+" "+f.materialName+(f.exteriorName?("/"+f.exteriorName):"")+" "+f.specificationName+(f.tolerance?("（"+f.tolerance+"）"):""))+'</p>有卖家报价，请尽快操作<a class="gotoaction" href="https://buyer.'+urlPath.domain+'/Purchaser?tab=waitConfirm">去操作</a></div></li>'});$("#_todo_list .msn_content_empty").remove();$("#_todo_list .msn_content_inner").show().find("ul").append(a);$("#_todo_num").data("count",c.total).html("待办（"+c.total+"）");$("#_buyer_top_num").html(c.total>99?"99+":c.total).show();var b=c.total+$("#_remind_num").data("count")||0;b>0?$("#_msg_top_num").html(b>99?"99+":b).show():$("#_msg_top_num").hide();!c.rows.length||_head.pageIndex++;if(self==top){$("#msn_chunk").show()}}if(c.isOk&&_head.pageIndex==1&&!c.rows.length){$("#_remind_num").click()}$("#_todo_list .msn_loading").hide();_head.loading=false;if(c.msg==="未登陆"){$("#msn_chunk").remove()}})},seller_top_num:function(){$.getJSON(location.protocol+"//seller."+urlPath.domain+"/jsonp/order/queryB1WaitOrderCount?jsoncallback=?",function(b){if(b.isOk){var a=b.data.waitOrderCount+b.data.waitPriceCount;if(b.data.waitOrderCount){$("#_waitOrderCount").data("count",b.data.waitOrderCount).html(b.data.waitOrderCount>99?"99+":b.data.waitOrderCount).show()}else{$("#_waitOrderCount").data("count",0).html(0).hide()}if(b.data.waitPriceCount){$("#_waitPriceCount").data("count",b.data.waitPriceCount).html(b.data.waitPriceCount>99?"99+":b.data.waitPriceCount).show()}else{$("#_waitPriceCount").data("count",0).html(0).hide()}if(a){$("#seller_head_num, #_seller_top_num").data("count",a).html(a>99?"99+":a).show()}else{$("#seller_head_num, #_seller_top_num").data("count",0).html(0).hide()}}else{console.log("queryB1WaitOrderCount: "+b.data)}})},onlineService:function(){if($(".navigation-wrap .linkNav").length||$(".header_box .nav").length){if(typeof $(document).totop=="undefined"){if(typeof goTop!=="undefined"){var a=new goTop()}}else{$(document).totop()}}}};var _header1={fn_bells:function(){var a=null;$(document).on({mouseenter:function(){$("#msn_chunk").show()}},"#msn_center")},fn_loadmore:function(){$(".msn_content").scroll(function(){var c=$(this).scrollTop(),b=$(this).find(".msn_list").height(),a=$(this).outerHeight(!0);if(c+a>=b&&(_head.pageIndex-1)*10<$("#_todo_num").data("count")){$(this).find(".msn_loading").show();_head.msg_todo()}})},fn_bells_tab:function(){$(document).on("click",".msn_tab span",function(){var a=$(this).index();$(this).addClass("active").siblings("span").removeClass("active"),$(".msn_content_wrap .msn_content").hide().eq(a).show()})},fn_bells_close:function(){$(document).on("click",".msn_close",function(){$("#msn_chunk").hide()})},init:function(){this.fn_bells(),this.fn_loadmore(),this.fn_bells_tab(),this.fn_bells_close()}};var _s={init:function(){$(document).on({click:function(a){a.stopPropagation();var b=$.trim(this.value);if(b){if($(".searchBar-input-list li").length&&$(".searchBar-input-list").data("type")=="autocomplate"){$(".searchBar-input-list").show()}else{_s.autocomplate(b)}}else{_s.historySearch()}},},".searchBar-input-inner input");$("#_headBarKey").on({keyup:function(){if($(this).prop("comStart")){return}var a=$.trim(this.value);a?_s.autocomplate(a):_s.historySearch()},keydown:function(a){if(a.keyCode==13){var b=$.trim(this.value);_s.searchPage(b);return}},compositionstart:function(a){$(this).prop("comStart",true)},compositionend:function(a){$(this).prop("comStart",false)},},".searchBar-input-inner input");$(document).on("click",".searchBar-input-list li",function(){var b=$(this).text();var a=$.trim(b.replace(/历史搜索/g,""));$(".searchBar-input-inner input").val(a);_s.searchPage(a)});$(document).on("click",function(){$(".searchBar-input-list").hide()})},searchPage:function(b){var c="?isBasicSearch=0&searchFlag=1&basicQuery="+encodeURIComponent(b||$.trim($(".searchBar-input-inner input").val()));var a="http://mall."+urlPath.domain+c;location.href=a},historySearch:function(){var b=$(".searchBar-input-list");var a=b.data("buff");if(a){b.html(a).show()}$.getJSON(location.protocol+"//buyer."+urlPath.domain+"/jsonp/search/latest?jsoncallback=?",function(d){if(d.isOk&&d.data.length){var c="<li>"+d.data.join('<span class="history">历史搜索</span></li><li>')+'<span class="history">历史搜索</span></li>';if(a==c){return}else{$(".searchBar-input-list").data("type","historySearch").data("buff",c).html(c).show()}}})},autocomplate:function(a){$.getJSON(location.protocol+"//buyer."+urlPath.domain+"/jsonp/search/autocomplate?jsoncallback=?&search="+encodeURIComponent(a),function(c){if(c.isOk&&c.data.length){var b="<li>"+c.data.join("</li><li>")+"</li>";$(".searchBar-input-list").data("type","autocomplate").html(b.split(a).join("<strong>"+a+"</strong>")).show()}else{$(".searchBar-input-list").data("type","autocomplate").html("").hide()}})}};var headBanner={jumpCategory:function(){if($("#bannerAllPro").length==0){return}$(document).on("click","#bannerAllPro .banner-left-section ul a,#bannerAllPro .bannerleft-dlWrap ul a",function(){var c=$("#selectedCategory").val();var d=$(this).attr("ptype");var b=$(this).text();var a=urlPath.mallUrl+"?"+d+"="+encodeURI(b);window.open(a)});$(document).on("mouseenter","#bannerAllPro .banner-left-section",function(){var c=$(this).find("div input").val();var e=$(this).find("div a").text();var f=$(this).find("ul input").val();var a=$("#bannerAllPro .bannerleft-dlWrap").eq(c);var d=$("#bannerAllPro .bannerleft-ad").eq(c);$("#selectedCategory").val(e);a.show().siblings("#bannerAllPro .bannerleft-dlWrap").hide();d.show().siblings("#bannerAllPro .bannerleft-ad").hide();var b=d.attr("loaded");if(typeof(b)=="undefined"||!b){d.attr("loaded",true);$.getJSON("https://member."+urlPath.domain+"/jsonp/queryBannerListById?jsoncallback=?&abId="+f,function(i){if(i!=null&&i.success){var g=i.data;if(g){var h="<ul>";$.each(g,function(j,k){h+="<li><a href="+k.link+" target='_blank'><img src="+k.picture+" alt=''></a></li>"});h+="</ul>";d.html(h)}}else{if(i==null){console.log("推荐卖家广告获取失败,返回值为空！")}else{console.log("推荐卖家广告获取失败"+i.message)}}})}})},init:function(){this.jumpCategory()}};$(function(){_s.init();_head.init();_header1.init();headBanner.init()});